(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/weather/index"],{30:function(e,t,a){"use strict";(function(e){a(5);n(a(3));var t=n(a(31));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=a,e(t.default)}).call(this,a(1)["createPage"])},31:function(e,t,a){"use strict";a.r(t);var n=a(32),r=a(34);for(var i in r)"default"!==i&&function(e){a.d(t,e,(function(){return r[e]}))}(i);a(40);var o,u=a(15),c=Object(u["default"])(r["default"],n["render"],n["staticRenderFns"],!1,null,null,null,!1,n["components"],o);c.options.__file="pages/weather/index.vue",t["default"]=c.exports},32:function(e,t,a){"use strict";a.r(t);var n=a(33);a.d(t,"render",(function(){return n["render"]})),a.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]})),a.d(t,"recyclableRender",(function(){return n["recyclableRender"]})),a.d(t,"components",(function(){return n["components"]}))},33:function(e,t,a){"use strict";var n;a.r(t),a.d(t,"render",(function(){return r})),a.d(t,"staticRenderFns",(function(){return o})),a.d(t,"recyclableRender",(function(){return i})),a.d(t,"components",(function(){return n}));try{n={ecCanvas:function(){return Promise.all([a.e("common/vendor"),a.e("components/ec-canvas")]).then(a.bind(null,313))}}}catch(u){if(-1===u.message.indexOf("Cannot find module")||-1===u.message.indexOf(".vue"))throw u;console.error(u.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var r=function(){var e=this,t=e.$createElement,a=(e._self._c,e.basic?e.QueryWinDir(e.basic["WIN_D_S_Max"]):null),n=e.basic?e.QueryWinSpeed(e.basic["WIN_S_Max"]):null,r=e.nearForcestData?e.__map(e.nearForcestData,(function(t,a){var n=e.__get_orig(t),r=e.formatNearForcestData(t["Validtime"]),i=t["TEM"]?parseFloat(t["TEM"]).toFixed(1):null,o=e.QueryWinS(t["WIN_U"],t["WIN_V"]),u=e.QueryWinD(t["WIN_U"],t["WIN_V"]);return{$orig:n,m2:r,g0:i,m3:o,m4:u}})):null,i=JSON.stringify(e.sevenData),o="{}"!=i?e.__map(e.sevenData.day7,(function(t,a){var n=e.__get_orig(t),r=t?e.QueryWinDir(t["win"]):null,i=t?e.QueryWinSpeed(t["speed"]):null;return{$orig:n,m5:r,m6:i}})):null,u=e.airqualityData?e.__map(e.airqualityData,(function(t,a){var n=e.__get_orig(t),r=a<e.airqualityStateLength?e.GetEleName(t.name):null,i=a<e.airqualityStateLength?e.DataCheck(t.value):null;return{$orig:n,m7:r,m8:i}})):null;e.$mp.data=Object.assign({},{$root:{m0:a,m1:n,l0:r,g1:i,l1:o,l2:u}})},i=!1,o=[];r._withStripped=!0},34:function(e,t,a){"use strict";a.r(t);var n=a(35),r=a.n(n);for(var i in n)"default"!==i&&function(e){a.d(t,e,(function(){return n[e]}))}(i);t["default"]=r.a},35:function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(a(36)),r=c(a(39)),i=s(a(25)),o=a(26);function u(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return u=function(){return e},e}function c(e){if(e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var t=u();if(t&&t.has(e))return t.get(e);var a={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=n?Object.getOwnPropertyDescriptor(e,r):null;i&&(i.get||i.set)?Object.defineProperty(a,r,i):a[r]=e[r]}return a.default=e,t&&t.set(e,a),a}function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function d(e,t,a,n,r,i,o){try{var u=e[i](o),c=u.value}catch(s){return void a(s)}u.done?t(c):Promise.resolve(c).then(n,r)}function f(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var i=e.apply(t,a);function o(e){d(i,n,r,o,u,"next",e)}function u(e){d(i,n,r,o,u,"throw",e)}o(void 0)}))}}var y=getApp().globalData,m={data:function(){return{basic:{},currentCity:y.BASE_CONFIG.location.city,infoDate:{week:i.default.getWeekDate(),date:(new Date).Format("MM月dd日")},nearForcestData:null,nearForcestDate:[],weaImg:null,BJDate:new Date,sevenData:{},ec:{disableTouch:!0,lazyLoad:!0},QueryWeather:o.queryWeather,QueryWeather2:o.queryWeather2,QueryWinD:o.queryWinD,QueryWinS:o.queryWinS,QueryWinDir:o.queryWinDir,QueryWinSpeed:o.queryWinSpeed,DataCheck:o.dataCheck,GetEleName:o.getEleName,airqualityData:null,airqualityState:!0,airqualityStateLength:0}},onShow:function(){var t=this;this.currentCity=y.BASE_CONFIG.location.city,e.showToast({title:"加载中",icon:"loading",duration:1e4}),this.getNow((function(a){e.hideToast(),t.basic=a.DS[0],t.basic["Time"]=t.basic["Datetime"].substr(6,2)+"日"+t.basic["Datetime"].substr(8,2)+"时"})),this.getNearForcest((function(a){e.hideToast(),t.nearForcestData=a.slice(1,24)})),this.getSevenForecast((function(a){console.log("newSevenData",a),e.hideToast(),t.sevenData=t.formatSevenDayData(a),console.info("sevenData",t.sevenData),t.weaImg="/static/images/weather/".concat((i.default.isDaylight()?(0,o.queryWeather)(t.sevenData.day7[0].wea[0],"n").image:(0,o.queryWeather)(t.sevenData.day7[0].wea[1],"d")).image,".png"),t.$nextTick((function(){var a=e.createSelectorQuery().in(t);a.select(".temp-echart").boundingClientRect((function(e){t.init7DayEchart(t.sevenData.day7,e.width,e.height)})).exec()}))})),this.getAirqualityForecast((function(a){e.hideToast(),t.airqualityData=t.formatAirqualityData(a),t.airqualityStateLength=t.airqualityData.length}))},methods:{getNow:function(t){var a=i.default.toTimeWorld(this.BJDate),n=a.Format("yyyyMMddhhmmss"),r=i.default.getAppointHourStr(a,-2,"yyyyMMddhhmmss");e.request({url:"".concat(y.API.wx_api,"/queryUdi/getEleByTimeRangeAndRadius?interfaceId=getEleByTimeRangeAndRadius&dataCode=SURF_NX_MUL_HOR&timeRange=%5B").concat(r,",").concat(n,"%5D&elements=Datetime,Station_Id_C,TEM,PRE_1h,PRE_24h,WIN_D_S_Max,WIN_S_Max,PRS,RHU&distance=5000&orderBy=Datetime:desc"),header:{"Content-Type":"application/json"},data:{key:y._apiKey,lat:y.BASE_CONFIG.location.lat,lon:y.BASE_CONFIG.location.lon,an:y.BASE_CONFIG.location.curid.substr(0,4)},dataType:"json",success:function(e){if(console.log("res",e),e&&e.data&&e.data.DS&&e.data.DS.length>0)for(var a=0;a<e.data.DS.length;a++)if("999999"!=e.data.DS[a]["PRS"]||999999!=e.data.DS[a]["PRS"]){t(e.data);break}}})},getNearForcest:function(e){var t=this;return f(n.default.mark((function a(){var r,o,u,c;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:r=t,o=0;case 2:if(!(o>-6)){a.next=14;break}return r.nearForcestData=null,u=i.default.getAppointHourStr(new Date,o,"yyyyMMddhh0000"),a.next=7,t.myRequest({url:"".concat(y.API.wx_api,"/queryUdi/getEleByTime?dataCode=SEVP_NX_WEFC_RFFC&interfaceId=getEleByTime&times=").concat(u,"&elements=Validtime,TEM,WIN_U,WIN_V&eleValueRanges=Station_Id_C:E").concat((.1*Math.round(Number(y.BASE_CONFIG.location.lon)/.1)).toFixed(3),"_N").concat((.1*Math.round(Number(y.BASE_CONFIG.location.lat)/.1)).toFixed(3))});case 7:if(c=a.sent,!(c.data.DS.length>0)){a.next=11;break}return e(c.data.DS),a.abrupt("break",14);case 11:o--,a.next=2;break;case 14:case"end":return a.stop()}}),a)})))()},formatNearForcestData:function(e,t){var a=(new Date).getHours(),n=null;return n=a+e===24?i.default.getAppointHourStr(new Date,e,"MM月dd日"):i.default.getAppointHourStr(new Date,e,"hh:00"),console.log("time",n),{time:n}},getTimeRangeStrByCurrentTime:function(){var e=(new Date).getHours(),t="";return e>=18?t=2:e>13?t=1:e>7?t=0:e>=0&&(t=3),t},getSevenForecast:function(t){var a,n=this.BJDate.getHours();a=n<8?i.default.getAppointDateStr(this.BJDate,-1,"yyyyMMdd120000"):n>=8&&n<20?i.default.getAppointDateStr(this.BJDate,0,"yyyyMMdd000000"):i.default.getAppointDateStr(this.BJDate,0,"yyyyMMdd120000"),e.request({url:"".concat(y.API.wx_api,"/queryUdi/getEleByTimeAndAreaCode?dataCode=SEVP_NX_WEFC_RFFC&interfaceId=getEleByTimeAndAreaCode&times=").concat(a,"&elements=Station_Id_C,Datetime,Validtime,TEM_Max_24h,TEM_Min_24h,WEP_Past_12h,WIN_PD_12h,WIN_S_Max_12h&areacode=")+y.BASE_CONFIG.location.curid.substr(0,6)+"&eleValueRanges=Validtime:12,24,36,48,60,72,84,96,108,120,132,144,156,168;Prod_Code:SPCC",header:{"Content-Type":"application/json"},dataType:"json",success:function(e){0==e.data.returnCode&&t(e.data.DS)}})},formatSevenDayData:function(e){var t,a,n=Math.ceil(y.systemInfo.windowWidth/5),r=[];for(var u in e){var c=e[u];if(null==a)a=c["Station_Id_C"];else if(a!=c["Station_Id_C"])continue;if(c["Validtime"]%24!=0)parseInt(c["WIN_PD_12h"]),parseInt(c["WIN_S_Max_12h"]),t=(i.default.isDaylight()?(0,o.queryWeather2)(c["WEP_Past_12h"],"n"):(0,o.queryWeather2)(c["WEP_Past_12h"],"d")).name;else{var s=i.default.toTimeZone(c["Datetime"],parseInt(c["Validtime"])-24,"MM月dd日"),l=parseInt(c["TEM_Min_24h"]),d=parseInt(c["TEM_Max_24h"]),f=parseInt(c["TEM_Max_24h"]),m=parseInt(c["WIN_S_Max_12h"]),h=[t,(i.default.isDaylight()?(0,o.queryWeather2)(c["WEP_Past_12h"],"n"):(0,o.queryWeather2)(c["WEP_Past_12h"],"d")).name];r.push({date:s,tempMax:d,tempMin:l,win:f,speed:m,wea:h,width:n+"px",src:["/static/images/weather/".concat((0,o.queryWeather)(h[0],"d").image,".png"),"/static/images/weather/".concat((0,o.queryWeather)(h[1],"n").image,".png")]})}}return{daysWidth:7*n+"px",day7:r}},init7DayEchart:function(e,t,a){var n=this;console.info(e,t,a);for(var i=[],o=[],u=9999,c=-9999,s=0;s<e.length;s++)u=Math.min(e[s].tempMin,u),c=Math.max(e[s].tempMax,c),i.push(e[s].tempMin),o.push(e[s].tempMax);this.$refs["ec-canvas"].init((function(e){var s=r.init(e,null,{width:t,height:a}),d=l({calcubale:!1,animation:!0,xAxis:[{type:"category",boundaryGap:!1,splitLine:!1,axisLabel:!1,splitArea:!1,axisLine:!1,axisTick:!1}],yAxis:[{splitLine:!1,scale:!1,allowDecimals:!1,splitNumber:"4",min:1*u,max:1*c,type:"value",show:!1,boundaryGap:!1,splitArea:!1,axisLine:!1,axisTick:!1}],grid:{x:40,x2:40,y:40,y2:40,borderWidth:0},series:[{type:"line",smooth:!0,symbol:"circle",symbolSize:5,itemStyle:{color:"#F59F1E"},lineStyle:{color:"#F59F1E",width:1},label:{color:"#fff",show:!0,fontSize:14,position:"top",formatter:"{c}°"},data:o},{type:"line",smooth:!0,symbol:"circle",symbolSize:5,itemStyle:{color:"#43B3FF"},lineStyle:{color:"#43B3FF",width:1},label:{color:"#fff",fontSize:14,show:!0,position:"bottom",formatter:"{c}°"},data:i}]},"animation",!1);return s.setOption(d),n.tempEchart=s,s}))},getAirqualityForecast:function(t){var a=this,n=i.default.toTimeWorld(this.BJDate),r=n.Format("yyyyMMddhhmmss"),o=i.default.getAppointHourStr(n,-12,"yyyyMMddhhmmss");e.request({url:"".concat(y.API.wx_api,"/queryUdi/getEleByTimeRangeAndRadius?interfaceId=getEleByTimeRangeAndRadius&dataCode=CAWN_MEE_AIR_EMO&timeRange=%5B").concat(o,",").concat(r,"%5D&elements=V_QUAL,V_PPOLLU,V15823,V15810,PM2p5_Densty,PM10_Densty_Fore&distance=15000&orderBy=Datetime:desc"),header:{"Content-Type":"application/json"},data:{key:y._apiKey,lat:y.BASE_CONFIG.location.lat,lon:y.BASE_CONFIG.location.lon,an:y.BASE_CONFIG.location.curid.substr(0,4)},dataType:"json",success:function(e){if(a.airqualityData=null,e&&e.data&&e.data.DS&&e.data.DS.length>0)for(var n=0;n<e.data.DS.length;n++)if("999900"!=e.data.DS[n]["V_QUAL"]){t(e.data.DS[n]);break}}})},formatAirqualityData:function(e){var t="\n\t\t        width: ".concat((y.systemInfo.windowWidth-20)/4,"px;\n\t\t        height: ").concat((y.systemInfo.windowWidth-20)/4,"px \n\t\t    "),a={"AQI等级":"AQIDJ","AQI指数":"AQIZS","首要污染物":"SYWYW"},n=[];for(var r in e)"预报时效"!=r&&n.push({name:r,value:e[r],style:t,src:"/static/images/airquality/".concat(a[r]||r,".png")});return n},goToSearch:function(){e.navigateTo({url:"./search",fail:function(e){console.log(e)}})},toogleAirqualityState:function(e){},myRequest:function(t){return new Promise((function(a,n){e.request({url:t.url,data:t.params||{},method:t.method||"GET",success:function(e){a(e)},fail:function(t){e.showToast({title:"网络错误，稍后重试！",icon:"error",duration:3e3}),n(null)}})}))}}};t.default=m}).call(this,a(1)["default"])},40:function(e,t,a){"use strict";a.r(t);var n=a(41),r=a.n(n);for(var i in n)"default"!==i&&function(e){a.d(t,e,(function(){return n[e]}))}(i);t["default"]=r.a},41:function(e,t,a){}},[[30,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/weather/index.js.map